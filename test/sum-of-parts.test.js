const partsSums = require('../lib/sum-of-parts')
const chai = require("chai");
const assert = chai.assert;
chai.config.truncateThreshold = 0;

describe("partsSums",function() {

function dotest(ls, expect) {
    let actual = partsSums(ls);
    assert.deepEqual(actual, expect);
}

it("Basic tests",function() {
    dotest([], [0]);
    dotest([0, 1, 3, 6, 10], [20, 20, 19, 16, 10, 0]);
    dotest([1, 2, 3, 4, 5, 6], [21, 20, 18, 15, 11, 6, 0]);

    dotest([744125, 935, 407, 454, 430, 90, 144, 6710213, 889, 810, 2579358],
            [10037855, 9293730, 9292795, 9292388, 9291934, 9291504, 9291414, 9291270, 2581057, 2580168, 2579358, 0]);

    dotest([30350, 76431, 156228, 78043, 98977, 80169, 32457, 182875, 162323, 17508, 57971, 171907],
            [1145239, 1114889, 1038458, 882230, 804187, 705210, 625041, 592584, 409709, 247386, 229878, 171907, 0]);

    dotest([158077, 143494, 196531, 26272, 35656, 68756, 109861, 36958, 83895, 134127, 81618, 193758, 143422],
            [1412425, 1254348, 1110854, 914323, 888051, 852395, 783639, 673778, 636820, 552925, 418798, 337180, 143422, 0]);

    dotest([3222, 77013, 124436, 117798, 28186, 183610, 121600, 20879, 44142, 23446, 154918, 54969, 94492],
            [1048711, 1045489, 968476, 844040, 726242, 698056, 514446, 392846, 371967, 327825, 304379, 149461, 94492, 0]);

    dotest([170110, 139570, 171544, 71770, 167818, 133006, 33628, 81872, 3143, 136857, 70720, 122107, 91191, 80135],
            [1473471, 1303361, 1163791, 992247, 920477, 752659, 619653, 586025, 504153, 501010, 364153, 293433, 171326, 80135, 0]);

    dotest([14231, 137542, 173347, 19792, 63830, 87040, 15621, 56268, 65441, 193264, 153828, 97321, 179116, 182144],
            [1438785, 1424554, 1287012, 1113665, 1093873, 1030043, 943003, 927382, 871114, 805673, 612409, 458581, 361260, 182144, 0]);

    dotest([198767, 63752, 180571, 115882, 199207, 3149, 151101, 91556, 39382, 117150],
            [1160517, 961750, 897998, 717427, 601545, 402338, 399189, 248088, 156532, 117150, 0]);

    dotest([19694, 183614, 199521, 155065, 6882, 125181, 130176, 105687, 47992, 81493],
            [1055305, 1035611, 851997, 652476, 497411, 490529, 365348, 235172, 129485, 81493, 0]);

    dotest([119450, 11268, 170483, 64155, 150893, 5826, 25660, 121156],
            [668891, 549441, 538173, 367690, 303535, 152642, 146816, 121156, 0]);

    dotest([129494, 8661, 83278, 157882, 71700, 176108, 140992, 46034, 43763, 33163, 11459, 30943, 27364, 44541, 166148],
            [1171530, 1042036, 1033375, 950097, 792215, 720515, 544407, 403415, 357381, 313618, 280455, 268996, 238053, 210689, 166148, 0]);

    dotest([7461, 88792, 18254, 13036, 187505, 49921, 48327, 169546, 163058, 187330, 160768, 165043, 35777, 140508, 147381],
            [1582707, 1575246, 1486454, 1468200, 1455164, 1267659, 1217738, 1169411, 999865, 836807, 649477, 488709, 323666, 287889, 147381, 0]);

    let u = [654379,430,3358426,885,902,96,933,672,895,7310034,6749922,905,1319962,4238020,722,565,558,133,48,217,5450103,3383902,966,7294724,686,3700414,4961574,278149,245,598,381];
    let sol = [48710446,48056067,48055637,44697211,44696326,44695424,44695328,44694395,44693723,44692828,37382794,30632872,30631967,29312005,25073985,25073263,25072698,
                                    25072140,25072007,25071959,25071742,19621639,16237737,16236771,8942047,8941361,5240947,279373,1224,979,381,0];
    dotest(u, sol);
})

it("Random tests",function() {
    function randint(a, b) {
        return Math.floor(Math.random() * (b - a + 1) + a);
    }
    function partsSums422(ls) {
        let t = ls.reduce((a, b) => a + b, 0);
        let res = Array(ls.length + 1).fill(0);
        res[0] = t;
        for (let i = 1; i < res.length; i++) {
            t -= ls[i - 1];
            res[i] = t;
        }
        return res;
    }
    function doEx(k) {
        var i = 0, res = [];
        while (i < k) {
            if (randint(0, 5) <= 4)
                res.push(randint(5, 20));
            else
                res.push(randint(10, 50));
            i++;
        }
        return res;
    }
    function random_tests0() {
        var i = 0;
        while (i < 25) {
            var s = doEx(randint(10, 20));
            dotest(s, partsSums422(s))
            i++;
        }
    }
    random_tests0();
    function random_tests1() {
        var i = 0;
        while (i < 25) {
            var s = doEx(randint(150000, 200000));
            dotest(s, partsSums422(s))
            i++;
        }
    }
    random_tests1();
    function random_tests2() {
        var i = 0;
        while (i < 15) {
            var s = doEx(randint(750000, 800000));
            var sol = partsSums422(s)
            dotest(s, sol)
            i++;
        }
    }
    random_tests2();
})})
